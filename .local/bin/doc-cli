#!/bin/sh
dir="$HOME/Documents"

ListFiles() {
	for fd in "${1}"/*; do
		if [ -d "${fd}" ]; then
			ListFiles "${fd}"
		else
			printf '%s\n' "${fd}"
		fi
	done
}



cmd() {
	cmd=${1}
	backupcmd=${2}
	if command -v ${cmd} >/dev/null; then
		printf "${cmd}"
	else
		printf "${backupcmd}"
	fi
}


open() {
	file="${1}"
	mimeType=$(file --mime-type --brief "${file}")
	case ${mimeType} in
		*/pdf)   setsid -f $(cmd zathura ${BROWSER}) "${file}" ;;
		text/*)  $(cmd ${EDITOR} ${BROWSER}) "${file}" ;;
		image/*) setsid -f $(cmd sxiv ${BROWSER}) "${file}" ;;
		*)       printf '%s: mime type is not implemented yet...\n' "${mimeType}"
	esac
}


main() {
	if ! command -v fzf >/dev/null; then
		tput bold
		printf '`fzf` is not installed, exiting\n'
		tput sgr0
	fi

	file="$(ListFiles "${dir}" | fzf)"

	if [ -f "${file}" ]; then
		open "${file}"
	fi
}
main
