#!/bin/sh
errorString='$TERMINAL variable is not set'

main(){
    selected=$(fzf --color fg+:4,bg+:-1,hl:4,hl+:6,pointer:2,prompt:2 < ~/.local/share/emoji.txt)
    [ -z "$selected" ] && exit

    echo "$selected" | cut -d ' ' -f1 | setsid -f xclip -r -selection clipboard &&
	setsid -f herbe "Copied $(echo "$selected" | cut -d' ' -f3-) emoji to clipboard"
}


in_terminal(){
    xrandr_output="$(xrandr | grep -E "\*")"
    x=$(echo "$xrandr_output" | awk -F' *|x' '{print $2}')
    y=$(echo "$xrandr_output" | awk -F' *|x' '{print $3}')

	case "$TERMINAL" in
		"st")
			st -t fzf-emoji -g 100x30+$(expr $x / 2 - 800 / 2)+$(expr $y / 2 - 600 / 2) -e $0 ;;
		"")
			if command -v herbe >/dev/null; then
				herbe "$errorString"
			else
				printf '%s' "$errorString"
			fi
			;;

		*)
			$TERMINAL -t fzf-emoji -e $0 ;;
	esac

}


if [ "$1" = "-t" ]; then
    in_terminal
else
    main
fi
